<Page
    x:Class="Invoice.InvoicePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Invoice"
    xmlns:vm="clr-namespace:Invoice.ViewModels"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    mc:Ignorable="d"
    d:Background="White"
    d:DesignHeight="700"
    d:DesignWidth="800"
    FontFamily="Biz UDGothic"
    Title="Invoice">
    <Page.Resources>
        <Style
            TargetType="Button"
            BasedOn="{StaticResource {x:Type Button}}">
            <Setter
                Property="FontFamily"
                Value="Biz UDGothic" />
        </Style>
        <CollectionViewSource Source="{Binding SettingsVM.TransactionTypeClassList}"
                              x:Key="TransactionTypeWithoutPlaceHolder" />
        <CollectionViewSource Source="{Binding SettingsVM.ItemClassList}" 
                              x:Key="ItemClassList"/>
        <CollectionViewSource Source="{Binding SettingsVM.TaxTypeClassList}"
                              x:Key="TaxTypeListWithoutPlaceHolder" />
        <Style x:Key="CustomDataGridCellStyle"
               TargetType="DataGridCell"
               BasedOn="{StaticResource DefaultDataGridCellStyle}">
            <Setter Property="OverridesDefaultStyle"
                    Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <ui:DataGridCellPresenter Background="{TemplateBinding Background}"
                                                  CurrencyVisualBrush="{DynamicResource DataGridCurrencyVisualPrimaryBrush}"
                                                  CurrencyVisualThickness="0"
                                                  FocusVisualPrimaryBrush="{DynamicResource DataGridCellFocusVisualPrimaryBrush}"
                                                  FocusVisualPrimaryThickness="0"
                                                  FocusVisualSecondaryBrush="{DynamicResource DataGridCellFocusVisualSecondaryBrush}"
                                                  FocusVisualSecondaryThickness="0"
                                                  IsCurrencyVisualVisible="{TemplateBinding IsSelected}"
                                                  IsFocusVisualVisible="{TemplateBinding IsKeyboardFocusWithin}"
                                                  MinHeight="{TemplateBinding MinHeight}"
                                                  SnapsToDevicePixels="True" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGridCell" x:Key="CustomDataGridCellstyleR"
                BasedOn="{StaticResource CustomDataGridCellStyle}">
            <Setter Property="HorizontalAlignment"
                    Value="Right" />
            <Setter Property="Padding"
                    Value="0,0,5,0" />
        </Style>

    </Page.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition
                Height="155" />
            <RowDefinition
                Height="*" />
        </Grid.RowDefinitions>
        <Grid
            Grid.Row="0"
            x:Name="NavigationGrid"
            Background="#4CAF50"
            Panel.ZIndex="0">
            <Grid.RowDefinitions>
                <RowDefinition
                    Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <Label
                FontSize="32px"
                FontWeight="Bold"
                Foreground="White"
                HorizontalAlignment="Center"
                Margin="0,40,0,25">請求書管理</Label>
            <StackPanel
                Grid.Row="1"
                Height="30"
                VerticalAlignment="Top"
                HorizontalAlignment="Center"
                Orientation="Horizontal"
                Background="Transparent">
                <StackPanel.Resources>
                    <Style
                        TargetType="Label">
                        <Setter
                            Property="Foreground"
                            Value="White" />
                        <Setter
                            Property="Margin"
                            Value="7,0" />
                        <Setter
                            Property="VerticalAlignment"
                            Value="Center" />
                        <Setter
                            Property="Cursor"
                            Value="Hand" />
                        <Setter
                            Property="HorizontalContentAlignment"
                            Value="Center" />
                        <Setter
                            Property="FontSize"
                            Value="16px" />
                    </Style>
                </StackPanel.Resources>
                <Label
                    x:Name="DashBoardLabel"
                    MouseLeftButtonUp="Label_MouseLeftButtonUp">ダッシュボード</Label>
                <Label
                    x:Name="CustomerLabel"
                    MouseLeftButtonUp="Label_MouseLeftButtonUp">利用者管理</Label>
                <Label
                    x:Name="InvoiceLabel"
                    MouseLeftButtonUp="Label_MouseLeftButtonUp">請求書管理</Label>
                <Label
                    x:Name="PaymentLabel"
                    MouseLeftButtonUp="Label_MouseLeftButtonUp">入金管理</Label>
                <Label
                    x:Name="SettingsLabel"
                    MouseLeftButtonUp="Label_MouseLeftButtonUp">設定</Label>
            </StackPanel>
        </Grid>
        <Grid
            Grid.Row="1"
            x:Name="InvoicePageContentsGrid"
            Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition
                    Height="Auto" />
                <RowDefinition
                    Height="Auto" />
                <RowDefinition
                    Height="*" />
                <RowDefinition
                    Height="50" />
            </Grid.RowDefinitions>
            <Grid
                Grid.Row="0"
                Width="700"
                MaxWidth="700"
                MinWidth="700"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Top">
                <Label
                    Content="請求書一覧"
                    FontSize="24"
                    FontWeight="Bold"
                    Margin="0,20" />
                <Grid
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <ui:ToggleSwitch
                        Grid.Column="1"
                        x:Name="ShowAllInvoice"
                        Toggled="ShowAllInvoice_Toggled"
                        Margin="0,0,0,0"
                        Width="120"
                        OnContent="指定期間"
                        OffContent="全期間"
                        Header="表示期間"
                        FontWeight="Bold"
                        />
                    
                    <ui:NumberBox
                        Grid.Column="2"
                                  x:Name="DateBox"
                                  Grid.Row="0"
                                  Padding="0,0,0,0"
                                  TextAlignment="Center"
                                  SpinButtonPlacementMode="Inline"
                                  VerticalAlignment="Center"
                                  FontSize="18"
                                  Value="300"
                                  Tag="0"
                                  IsEnabled="{Binding ElementName=ShowAllInvoice,Path=IsOn}"
                                  Maximum="6000"
                                  Minimum="-6000"
                                  Width="210"
                                  HorizontalContentAlignment="Center"
                                  VerticalContentAlignment="Center"
                                  ValueChanged="DateBox_ValueChanged">
                        <ui:NumberBox.Resources>
                            <Style TargetType="TextBox"
                                   BasedOn="{StaticResource DefaultTextBoxStyle}">
                                <Style.Triggers>
                                    <Trigger
                                        Property="Name"
                                        Value="InputBox">
                                        <Setter
                                            Property="Foreground"
                                            Value="Transparent" />

                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ui:NumberBox.Resources>
                    </ui:NumberBox>
                    <TextBlock x:Name="DateTextBlock"
                               Margin="2"
                               Width="140"
                               HorizontalAlignment="Left"
                               Grid.Column="2"
                               Height="{Binding ElementName=DateBox,Path=ActualHeight}"
                               Background="Transparent"
                               VerticalAlignment="Bottom"
                               TextAlignment="Center"
                               FontSize="18"
                               FontWeight="Bold"

                               FontFamily="{StaticResource ContentControlThemeFontFamily}"
                               Text="{Binding InvoiceVM.ViewDate}">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ElementName=ShowAllInvoice,Path=IsOn}"
                                             Value="False">
                                        <Setter Property="Foreground"
                                                Value="Gray" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Grid>

            </Grid>
            <DataGrid
                Grid.Row="2"
                x:Name="InvoiceListDataGrid"
                MouseDoubleClick="InvoiceListDataGrid_MouseDoubleClick"
                CanUserAddRows="False"
                CanUserResizeColumns="False"
                AutoGenerateColumns="False"
                VerticalAlignment="Stretch"
                VerticalScrollBarVisibility="Auto"
                SelectionUnit="FullRow"
                ItemsSource="{Binding InvoiceVM.InvoiceCollectionViewSource.View}"
                AlternatingRowBackground="#0C000000"
                ColumnHeaderHeight="28"
                CanUserDeleteRows="False"
                PreviewMouseRightButtonUp="InvoiceListDataGrid_PreviewMouseRightButtonUp"
                PreviewMouseLeftButtonDown="InvoiceListDataGrid_PreviewMouseLeftButtonDown"
                RowHeaderWidth="0">
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem x:Name="ContextMenuStatusChange"
                                  Header="ステータス変更">
                            <MenuItem Header="作成中" 
                                      x:Name="ContextMenuStatusDraft"
                                      Click="ContextMenuStatusChanged"/>
                            <MenuItem Header="請求済"
                                      x:Name="ContextMenuStatusCharged"
                                      Click="ContextMenuStatusChanged"/>
                            <MenuItem Header="入金済"
                                      x:Name="ContextMenuStatusDeposited"
                                      Click="ContextMenuStatusChanged"/>
                            <MenuItem Header="前受済"
                                      x:Name="ContextMenuStatusPrepaid"
                                      Click="ContextMenuStatusChanged"/>
                        </MenuItem>
                        <MenuItem x:Name="ContextMenuDelete"
                                  Header="削除"
                                  Click="DeleteInvoiceButton_Click"/>
                        <MenuItem x:Name="ContextMenuDeposit"
                                  Header="入金処理" 
                                  Click="ContextMenuDeposit_Click"/>
                        <MenuItem x:Name="ContextMenuCreatePDF"
                                  Header="PDF作成" 
                                  Click="CreateInvoiceButton_Click"/>
                        <MenuItem x:Name="ContextMenuCopyToNextMonth"
                                  Header="次月へコピー"
                                  Click="CopyInvoiceButton_Click"/>


                    </ContextMenu>
                </DataGrid.ContextMenu>
                <DataGrid.CellStyle>
                    <Style
                        TargetType="DataGridCell"
                        BasedOn="{StaticResource DefaultDataGridCellStyle}">
                        <Setter
                            Property="OverridesDefaultStyle"
                            Value="True" />
                        <Setter
                            Property="Template">
                            <Setter.Value>
                                <ControlTemplate
                                    TargetType="DataGridCell">
                                    <ui:DataGridCellPresenter
                                        Background="{TemplateBinding Background}"
                                        CurrencyVisualBrush="{DynamicResource DataGridCurrencyVisualPrimaryBrush}"
                                        CurrencyVisualThickness="0"
                                        FocusVisualPrimaryBrush="{DynamicResource DataGridCellFocusVisualPrimaryBrush}"
                                        FocusVisualPrimaryThickness="0"
                                        FocusVisualSecondaryBrush="{DynamicResource DataGridCellFocusVisualSecondaryBrush}"
                                        FocusVisualSecondaryThickness="0"
                                        IsCurrencyVisualVisible="{TemplateBinding IsSelected}"
                                        IsFocusVisualVisible="{TemplateBinding IsKeyboardFocusWithin}"
                                        MinHeight="{TemplateBinding MinHeight}"
                                        SnapsToDevicePixels="True" />
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </DataGrid.CellStyle>

                <DataGrid.ColumnHeaderStyle>
                    <Style
                        TargetType="{x:Type DataGridColumnHeader}">
                        <Setter
                            Property="FontSize"
                            Value="15" />
                        <Setter
                            Property="HorizontalContentAlignment"
                            Value="Center" />
                        <Setter
                            Property="Padding"
                            Value="0" />
                        <Setter
                            Property="Margin"
                            Value="0" />
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.Columns>
                <DataGridTemplateColumn
                    Width="30">
                    <DataGridTemplateColumn.Header>
                            <CheckBox x:Name="SelectAllCheckBox"
                                      Width="20"
                                      Checked="SelectAllCheckBox_Checked"
                                      Unchecked="SelectAllCheckBox_Unchecked"
                                      HorizontalAlignment="Center"
                                      HorizontalContentAlignment="Center">
                                <CheckBox.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="Width"
                                                Value="20" />
                                    </Style>
                                </CheckBox.Resources>
                            </CheckBox>
                        </DataGridTemplateColumn.Header>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                                <CheckBox
                                    x:Name="GridRowCheckBox"
                                    IsChecked="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=IsSelected, Mode=TwoWay}"
                                    PreviewMouseLeftButtonDown="InvoiceCheckBox_PreviewMouseLeftButtonDown"
                                    Width="20">
                                    <!--Checked="InvoiceCheckBox_Checked"
                                    Unchecked="InvoiceCheckBox_Unchecked"-->
                                    <CheckBox.Resources>
                                        <Style TargetType="CheckBox"
                                            BasedOn="{StaticResource DefaultCheckBoxStyle}">
                                            <Setter
                                                Property="HorizontalAlignment"
                                                Value="Center" />
                                            <Setter
                                                Property="Width"
                                                Value="20" />
                                            <Setter
                                                Property="Content">
                                                <Setter.Value>
                                                    <TextBlock
                                                        Width="0"
                                                        Visibility="Collapsed" />
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                        <Style
                                            TargetType="Grid">
                                            <Setter
                                                Property="Width"
                                                Value="20" />
                                        </Style>
                                        <Style
                                            TargetType="Border">
                                            <Setter
                                                Property="Width"
                                                Value="20" />
                                        </Style>
                                    </CheckBox.Resources>
                                </CheckBox>
                            </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>

                </DataGridTemplateColumn>
                    <DataGridTemplateColumn
                        Header="No."
                        Width="90*">
                        <DataGridTemplateColumn.CellTemplate>
                            
                            <DataTemplate>
                                <TextBlock
                                    
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Padding="0,0,5,0"
                                    Text="{Binding SlipNumber}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn
                        Header="宛先"
                        Width="100*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Text="{Binding CustomerName}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn
                        Header="件名"
                        Width="200*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Padding="5,0,0,0"
                                    Text="{Binding Subject}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn
                        Header="請求金額"
                        Width="100*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Padding="0,0,5,0"
                                    Text="{Binding Total,StringFormat={}{0:N0}}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn
                        Header="発行日"
                        Width="130*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Text="{Binding IssueDateString}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn
                        Header="ステータス"
                        Width="100*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Padding="0,0,5,0"
                                    Text="{Binding InvoiceStatus}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                </DataGrid.Columns>

            </DataGrid>
            <StackPanel
                Grid.Row="3"
                Margin="0,0,0,0"
                HorizontalAlignment="Center"
                Orientation="Horizontal">
                <StackPanel.Resources>
                    <Style TargetType="Button"
                           BasedOn="{StaticResource DefaultButtonStyle}">
                        <Setter Property="Width"
                                Value="110" />
                        <Setter Property="Height"
                                Value="30" />
                        <Setter Property="Margin"
                                Value="5,10,0,10" />
                        <Setter Property="FontSize"
                                Value="10pt" />
                    </Style>
                </StackPanel.Resources>
                <Button x:Name="AddInvoiceButton"
                        Content="請求書登録"
                        Margin="0,10,0,10"
                        Click="AddInvoiceButton_Click" />
                <Button x:Name="EditInvoiceButton"
                        Content="請求書編集"
                        Click="EditInvoiceButton_Click" />
                <Button x:Name="CreateInvoiceButton"
                        Content="請求書出力"
                        Click="CreateInvoiceButton_Click" />
                <Button x:Name="CopyInvoiceButton"
                        Content="次月へコピー"
                        Click="CopyInvoiceButton_Click" />
                <Button x:Name="DeleteInvoiceButton"
                        Content="削除"
                        Click="DeleteInvoiceButton_Click" />

            </StackPanel>
        </Grid>
        <Border
            x:Name="InvoiceDetailPane"
            Grid.Row="1"
            Background="White"
            Height="500"
            Padding="0"
            VerticalAlignment="Bottom"
            RenderTransformOrigin="0.5,1">
            <Border.RenderTransform>
                <TranslateTransform
                    x:Name="PaneTransform"
                    Y="{Binding RelativeSource={RelativeSource AncestorType=Border},Path=Height}" />
            </Border.RenderTransform>
            <Grid
                Margin="10,5,10,10">
                <Grid.RowDefinitions>
                    <RowDefinition
                        Height="Auto" />
                    <RowDefinition
                        Height="Auto" />
                    <RowDefinition
                        Height="50" />
                    <RowDefinition
                        Height="*" />
                    <RowDefinition
                        Height="50" />
                </Grid.RowDefinitions>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Label
                        Grid.Column="0"
                        d:Content="新規請求書作成"
                        Content="{Binding InvoiceVM.PaneTitle}"
                        FontSize="24"
                        Height="43"
                        FontWeight="Bold"
                        Margin="0,0,30,0" />
                    <Grid
                        Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Text="請求日"
                            Margin="0,2" />
                        <DatePicker
                            Grid.Row="1"
                            x:Name="InvoiceIssueDate"
                            BorderThickness="0"
                            Background="#0C000000"
                            FontSize="17"
                            SelectedDateFormat="Short"
                            Padding="0"
                            d:SelectedDate="2025/1/31"
                            HorizontalContentAlignment="Center"
                            InputMethod.IsInputMethodEnabled="False"
                            SelectedDateChanged="InvoiceIssueDate_SelectedDateChanged"
                            SelectedDate="{Binding InvoiceVM.CurrentInvoice.IssueDate,Mode=TwoWay}"
                            Width="180"
                            Margin="0,0,30,0">

                        </DatePicker>
                    </Grid>
                    <Grid
                        Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Text="期限日"
                            Margin="0,2" />
                        <DatePicker
                            Grid.Row="1"
                            x:Name="InvoiceDueDate"
                            BorderThickness="0"
                            Background="#0C000000"
                            FontSize="17"
                            d:SelectedDate="2025/2/15"
                            SelectedDate="{Binding InvoiceVM.CurrentInvoice.DueDate,Mode=TwoWay}"
                            SelectedDateFormat="Short"
                            HorizontalContentAlignment="Center"
                            InputMethod.IsInputMethodEnabled="False"
                            Margin="0,0,30,0"
                            Width="180" />
                    </Grid>

                    <Grid
                        Grid.Column="3"
                        Margin="0,0,0,0"
                        HorizontalAlignment="Stretch">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Margin="0,2"
                            Background="Transparent"
                            Text="決済方法" />
                        <ComboBox
                            x:Name="TransactionTypeComboBox"
                            ItemsSource="{Binding Source={StaticResource TransactionTypeWithoutPlaceHolder}}"
                            DisplayMemberPath="TransactionName"
                            SelectedValuePath="TransactionTypeId"
                            SelectedValue="{Binding InvoiceVM.CurrentInvoice.TransactionTypeId,Mode=TwoWay}"
                            
                            FontSize="20"
                            Grid.Row="1"
                            BorderThickness="0"
                            Background="#0C000000"
                            Width="160"
                            d:SelectedIndex="0"
                            />
                    </Grid>


                </Grid>
                <Grid
                    Margin="0,5,0,0"
                    HorizontalAlignment="Stretch"
                    Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="*" />
                        <ColumnDefinition
                            Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid
                        HorizontalAlignment="Left"
                        VerticalAlignment="Bottom"
                        Grid.Column="0"
                        Margin="0,0,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Text="宛先"
                            Margin="0,0,0,2" />
                        <ComboBox
                            x:Name="InvoiceName"
                            Grid.Row="1"
                            ItemsSource="{Binding CustomerVM.CustomerClassList}"
                            DisplayMemberPath="CustomerName"
                            SelectedValuePath="CustomerId"
                            SelectedValue="{Binding InvoiceVM.CurrentInvoice.CustomerId,Mode=TwoWay}"
                            SelectionChanged="InvoiceName_SelectionChanged"
                            Margin="0,0,30,0"
                            Width="168"
                            FontSize="20"
                            BorderThickness="0"
                            Background="#0C000000"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top" />
                    </Grid>
                    <Grid
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom"
                        Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Text="件名"
                            Margin="0,0,0,2" />
                        <TextBox
                            Margin="0,0,0,0"
                            Grid.Row="1"
                            FontSize="20"
                            x:Name="InvoiceSubject"
                            BorderThickness="0"
                                 Background="#FFF3F3F3"
                                 InputMethod.IsInputMethodEnabled="True"
                            InputMethod.PreferredImeConversionMode="FullShape,Native"
                            HorizontalContentAlignment="Left"
                            d:Text="利用料2025年1月分"
                            Text="{Binding InvoiceVM.CurrentInvoice.Subject,Mode=TwoWay}"
                            Width="390"
                            VerticalAlignment="Top" />
                    </Grid>
                    <Grid
                        Grid.Column="3"
                        Margin="0,0,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition
                                Height="37" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            FontWeight="Bold"
                            Text="合計" />
                        <Rectangle
                            Grid.Row="1"
                            RadiusX="2"
                            RadiusY="2"
                            Fill="#0C000000"
                            Margin="0,0,0,0" />
                        <TextBlock
                            Grid.Row="1"
                            x:Name="InvoiceAmmountTextBlock"
                            Background="Transparent"
                            TextAlignment="Right"
                            d:Text="￥6,7000"
                            FontSize="25"
                            Padding="0,0,5,0"
                            VerticalAlignment="Center"
                            FontWeight="Bold"
                            Text="{Binding InvoiceVM.InvoiceTotalAmount,Mode=OneWay,StringFormat=￥{0:N0}‐}"
                            Width="160" />
                    </Grid>

                </Grid>
                <Grid x:Name="MessageGrid"
                      Grid.Row="2"
                      Margin="0,3,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition 
                            Width="Auto"/>
                        <ColumnDefinition
                            Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="備考欄"
                               Margin="0,0,5,0"/>
                    <TextBox x:Name="MessageTextBox"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             Grid.Column="1"
                             BorderThickness="0"
                             Text="{Binding InvoiceVM.CurrentInvoice.Message,Mode=TwoWay}"
                             Background="#FFF3F3F3"
                             >
                        
                    </TextBox>
                </Grid>
                <DataGrid
                        x:Name="InvoiceItemsDataGrid"
                        VerticalAlignment="Stretch"
                        Grid.Row="3"
                        Margin="0,5,0,0"
                        CanUserAddRows="False"
                        CanUserResizeColumns="False"
                        AutoGenerateColumns="False"
                        BorderBrush="Gray"
                        BorderThickness="1"
                              ItemsSource="{Binding InvoiceVM.InvoiceItemClassList}"
                        AlternatingRowBackground="#0C000000"
                        ColumnHeaderHeight="30"
                        CanUserDeleteRows="False"
                        RowHeaderWidth="0"
                        AddingNewItem="InvoiceItemsDataGrid_AddingNewItem"
                        InitializingNewItem="InvoiceItemsDataGrid_InitializingNewItem"
                        >
                    <DataGrid.ColumnHeaderStyle>
                        <Style
                            TargetType="{x:Type DataGridColumnHeader}">
                            <Setter
                                Property="FontSize"
                                Value="15" />
                            <Setter
                                Property="HorizontalContentAlignment"
                                Value="Center" />
                        </Style>
                    </DataGrid.ColumnHeaderStyle>

                    <DataGrid.Columns>
                        
                        <DataGridTemplateColumn  Width="30">
                            <DataGridTemplateColumn.Header>
                                
                                <CheckBox
                                    x:Name="SelectAllItemCheckBox"
                                    Checked="SelectAllCheckBox_Checked"
                                    Unchecked="SelectAllCheckBox_Unchecked" />
                            </DataGridTemplateColumn.Header>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox
                                        x:Name="GridRowCheckBox"
                                        IsChecked="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=IsSelected, Mode=TwoWay}"
                                        PreviewMouseLeftButtonDown="InvoiceCheckBox_PreviewMouseLeftButtonDown"
                                        Width="20">
                                        <CheckBox.Resources>
                                            <Style
                                                TargetType="CheckBox"
                                                BasedOn="{StaticResource DefaultCheckBoxStyle}">
                                                <Setter
                                                    Property="HorizontalAlignment"
                                                    Value="Center" />
                                                <Setter
                                                    Property="Width"
                                                    Value="20" />
                                                <Setter
                                                    Property="Content">
                                                    <Setter.Value>
                                                        <TextBlock
                                                            Width="0"
                                                            Visibility="Collapsed" />
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                            <Style
                                                TargetType="Grid">
                                                <Setter
                                                    Property="Width"
                                                    Value="20" />
                                            </Style>
                                            <Style
                                                TargetType="Border">
                                                <Setter
                                                    Property="Width"
                                                    Value="20" />
                                            </Style>
                                        </CheckBox.Resources>
                                    </CheckBox>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>

                            </DataGridTemplateColumn>
                        <!--<DataGridComboBoxColumn Header="請求項目"
                                                Width="200"
                                                ItemsSource="{Binding Source={StaticResource ItemClassList}}"
                                                DisplayMemberPath="ItemName"
                                                SelectedValuePath="ItemId"
                                                SelectedValueBinding="{Binding ItemId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>-->
                        <DataGridTemplateColumn
                            Header="請求項目"
                            Width="200*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ComboBox
                                        x:Name="InvoiceItemName"
                                        ItemsSource="{Binding Source={StaticResource ItemClassList}}"
                                        DisplayMemberPath="ItemName"
                                        SelectedValuePath="ItemId"
                                        SelectedValue="{Binding ItemId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        BorderThickness="0"
                                        HorizontalAlignment="Stretch"
                                        Background="Transparent"
                                        IsSynchronizedWithCurrentItem ="False"
                                        SelectionChanged="InvoiceItemName_SelectionChanged"
                                        
                                        />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="単価"
                                            Width="80*"
                                            Binding="{Binding UnitPrice,Mode=TwoWay,StringFormat={}@{0:N0}}"
                                            CellStyle="{StaticResource CustomDataGridCellstyleR}"
                                            AutomationProperties.IsRequiredForForm="True"/>
                        <!--<DataGridTemplateColumn
                            Header="単価"
                            Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Padding="0,0,5,0"
                                        Text="{Binding UnitPrice,Mode=TwoWay,StringFormat={}@{0:N0}}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <TextBox
                                        Text="{Binding UnitPrice,Mode=TwoWay}"
                                        AutomationProperties.IsRequiredForForm="True" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>-->
                        <DataGridTextColumn Header="数量"
                                            Width="60*"
                                            Binding="{Binding Quantity,Mode=TwoWay,StringFormat={}{0:N0}}"
                                            CellStyle="{StaticResource CustomDataGridCellstyleR}" 
                                            AutomationProperties.IsRequiredForForm="True"/>
                        <!--<DataGridTemplateColumn
                            Header="数量"
                            Width="50">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Padding="0,0,5,0"
                                        Text="{Binding Quantity,Mode=OneWay,StringFormat={}{0:N0}}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <TextBox
                                        Text="{Binding Quantity,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                        AutomationProperties.IsRequiredForForm="True" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>

                        </DataGridTemplateColumn>-->
                        <DataGridTextColumn Header="単位"
                                            Width="50*"
                                            Binding="{Binding Unit,Mode=TwoWay}"
                                            CellStyle="{StaticResource CustomDataGridCellStyle}"
                                            AutomationProperties.IsRequiredForForm="True"/>
                        <!--<DataGridTemplateColumn
                            Header="単位"
                            Width="50">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Padding="0,0,5,0"
                                        Text="{Binding Unit, Mode=OneWay}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <TextBox
                                        Text="{Binding Unit,Mode=TwoWay}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>

                        </DataGridTemplateColumn>-->
                        <DataGridTextColumn Header="小計"
                                            Width="90*"
                                            IsReadOnly="True"
                                            CellStyle="{StaticResource CustomDataGridCellstyleR}"
                                            Binding="{Binding ItemSubTotal,StringFormat={}{0:N0}}"/>
                        <!--<DataGridTemplateColumn
                            Header="小計"
                            Width="90">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Stretch"
                                        TextAlignment="Right"
                                        Padding="0,0,5,0"
                                        Text="{Binding ItemSubTotal,StringFormat={}{0:N0}}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>-->
                        <DataGridComboBoxColumn Header="税種"
                                                Width="100*"
                                                x:Name="TaxTypeNameComboBox"
                                                ItemsSource="{Binding Source={StaticResource TaxTypeListWithoutPlaceHolder}}"
                                                DisplayMemberPath="TaxTypeName"
                                                SelectedValuePath="TaxTypeId"
                                                SelectedValueBinding="{Binding TaxTypeId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        <!--<DataGridTemplateColumn
                            x:Name="TaxTypeNameColumn"
                            Header="税種"
                            Width="100"
                            >
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ComboBox
                                        x:Name="TaxTypeNameComboBox"
                                        ItemsSource="{Binding Source={StaticResource TaxTypeListWithoutPlaceHolder}}"
                                        DisplayMemberPath="TaxTypeName"
                                        SelectedValuePath="TaxTypeId"
                                        SelectedValue="{Binding TaxTypeId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                        BorderThickness="0"
                                        Background="Transparent"
                                        Width="100" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>-->
                        <DataGridTextColumn Header="税額"
                                            Width="50*"
                                            IsReadOnly="True"
                                            Binding="{Binding Tax, StringFormat={}{0:N0}}"
                                            CellStyle="{StaticResource CustomDataGridCellstyleR}"/>

                        <!--<DataGridTemplateColumn
                            Header="税額"
                            Width="50">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Stretch"
                                        TextAlignment="Right"
                                        Padding="0,0,5,0"
                                        Text="{Binding Tax,StringFormat={}{0:N0}}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>-->
                        <DataGridTextColumn Header="項目計"
                                            Width="90*"
                                            IsReadOnly="True"
                                            Binding="{Binding ItemTotal,StringFormat={}{0:N0}}"
                                            CellStyle="{StaticResource CustomDataGridCellstyleR}"/>
                        <!--<DataGridTemplateColumn
                            Header="項目計"
                            Width="90">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Stretch"
                                        TextAlignment="Right"
                                        Padding="0,0,5,0"
                                        Text="{Binding ItemTotal,StringFormat={}{0:N0}}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>-->
                    </DataGrid.Columns>
                </DataGrid>
                <Grid
                    Grid.Row="4"
                    HorizontalAlignment="Stretch"
                    Margin="0,0,0,0"
                    VerticalAlignment="Bottom">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="*" />
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Button
                        Grid.Column="0"
                        Margin="2,0"
                        x:Name="AddInvoiceItemButton"
                        Content="項目追加"
                        Width="90"
                        VerticalAlignment="Bottom"
                        Click="AddInvoiceItemButton_Click"
                        Height="32" />
                    <Button
                        Grid.Column="1"
                        Margin="2,0"
                        x:Name="DeleteInvoiceItemButton"
                        Content="項目削除"
                        Width="90"
                        VerticalAlignment="Bottom"
                        Click="DeleteInvoiceItemButton_Click"
                        Height="32" />
                    <Button
                        Grid.Column="3"
                        x:Name="SaveInvoiceButton"
                        Margin="2,0"
                        d:Content="保存"
                        Content="{Binding InvoiceVM.SaveButtonText}"
                        Width="90"
                        VerticalAlignment="Bottom"
                        Click="SaveInvoiceButton_Click"
                        Height="32" />
                    <Button
                        Grid.Column="4"
                        x:Name="InvoiceCancelButton"
                        Margin="2,0"
                        Content="キャンセル"
                        Width="90"
                        VerticalAlignment="Bottom"
                        Click="InvoiceCancelButton_Click"
                        Height="32" />
                    <Grid
                        Margin="2,0"
                        Grid.Column="5"
                        VerticalAlignment="Bottom">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition
                                Height="32" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Margin="0,0,0,2"
                            Background="Transparent"
                            Text="ステータス"
                            VerticalAlignment="Bottom" />
                        <ComboBox
                            x:Name="StatusComboBox"
                            Grid.Row="1"
                            BorderThickness="0"
                            Background="#0C000000"
                            Width="150"
                            SelectedIndex="0"
                            ItemsSource="{Binding InvoiceVM.InvoiceStatusClassList}"
                            DisplayMemberPath="InvoiceStatus"
                            SelectedValuePath="InvoiceStatusId"
                            SelectedValue="{Binding InvoiceVM.CurrentInvoice.InvoiceStatusId,Mode=TwoWay}"
                            Padding="12,0,0,0"
                            FontSize="20">
                            <ComboBox.Resources>
                                <Style
                                    TargetType="ComboBoxItem">
                                    <Setter
                                        Property="Padding"
                                        Value="0" />
                                </Style>
                            </ComboBox.Resources>
                        </ComboBox>
                    </Grid>

                </Grid>
            </Grid>
        </Border>
    </Grid>
</Page>
